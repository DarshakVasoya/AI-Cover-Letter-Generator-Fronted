# C4 Model Documentation

This document provides Context, Containers, Components, and (future) Code level views for the AI Cover Letter Generator.

## 1. System Context (Level 1)

```
+---------------------------+          +-------------------+
| End User (Job Seeker)    |          |  Recruiter (future)|
| - Uploads resume (PDF)   |          |  - (Possible share)|
| - Pastes job description |          +----------+--------+
| - Downloads cover letter |                     ^
+------------+--------------+                     |
             | HTTP (Browser)
             v
+------------+----------------------------------------------+
| AI Cover Letter Generator (Web App)                      |
|  - React/Next.js frontend                                |
|  - Communicates with AI Backend API                      |
+------------+--------------------------+------------------+
             | REST (multipart/form-data) / JSON
             v
+------------+----------------------------------------------+
| AI Backend API (Flask + LLM Provider)                     |
|  - Parse PDF resume text                                 |
|  - Call Gemini / LLM to craft tailored cover letter       |
|  - Return generated letter JSON                          |
+------------+--------------------------+------------------+
             | Potential External APIs (future): Jobs, OCR, Auth
             v
+------------------+   +------------------+   +-----------------+
| LLM Provider     |   | OCR Service      |   | Auth Provider   |
| (Gemini/OpenAI)  |   | (future scanned) |   | (future users)  |
+------------------+   +------------------+   +-----------------+
```

## 2. Container Diagram (Level 2)

Containers:
- Browser (React/Next.js App)
- Backend API (Flask service)
- LLM Provider (external)
- Storage (future: DB for users & drafts)
- Object Storage (future: resume file archival)

```
+--------------------------------------------------------------+
| Browser / Next.js App                                        |
|  - Upload form                                               |
|  - Validation (size, required fields)                        |
|  - Local draft persistence (localStorage)                    |
|  - PDF generation (jsPDF)                                    |
|  - Accessibility (aria-live)                                 |
+-----------------+----------------------+---------------------+
                  | POST /generate_coverletter (multipart)
                  v
+--------------------------------------------------------------+
| Flask API Container                                          |
|  Components:                                                 |
|   - Upload Handler (validates PDF)                           |
|   - PDF Text Extractor (PyPDF / fallback OCR future)         |
|   - Prompt Builder                                           |
|   - LLM Client (Gemini)                                      |
|   - Response Formatter                                       |
| (Future: Auth, Rate Limit, Metrics, Caching)                 |
+--------------+------------------+---------------------------+
               | LLM API Call
               v
+--------------------+    +-----------------------+
| Gemini / LLM API   |    | OCR Service (future)  |
+--------------------+    +-----------------------+
               ^
               | (Future: store logs, prompts)
               v
        +--------------------+
        | Database (future)  |
        +--------------------+
```

## 3. Component Diagram (Level 3 - Current Frontend)

Frontend Components (Next.js App Router):
- `Header` (branding + tagline)
- `Home Page` (`page.js`): orchestrates form, state, API call
  - File Input Module (resume PDF handling)
  - Job Description Textarea
  - Generate Button (validation + loading state)
  - Cover Letter Editor (textarea + autosave)
  - PDF Export Action (uses `exportCoverLetterToPDF`)
  - Status & Error Handling (aria-live region)
- `Logo` (SVG + animations)
- `lib/api.js` (API client: multipart submission, timeout, fallback)
- `lib/pdf.js` (PDF generation & justification)
- Global Styles (`globals.css`)

Backend (abstracted from this repo):
- Upload Endpoint `/generate_coverletter`
- Resume Parser (extracts text)
- Prompt Builder (merge JD + resume summary + style)
- LLM Client (Gemini wrapper)
- Formatter (normalize JSON fields)

## 4. Code / Implementation Notes (Level 4 Snapshot)
(Not full class diagram—key functions & flows.)

Frontend Flow:
1. User selects PDF -> `handleFileChange` validates size & sets state.
2. User pastes job description -> state updates & autosaves to localStorage.
3. User clicks Generate -> `handleGenerate` builds multipart and calls `generateCoverLetterAPI`.
4. Backend returns JSON -> cover letter state updated -> focus shifts to editor.
5. User optionally edits -> can download via `exportCoverLetterToPDF` (justified text, multi-page).

Key Functions:
- `generateCoverLetterAPI({ resumeFile, jobRequirements })` -> POST, returns JSON.
- `exportCoverLetterToPDF(coverLetter)` -> builds justified PDF.
- `justifyLine` (internal) -> distributes extra spaces for non-final lines.

## 5. Quality Attributes
- Performance: Client bundles kept lean; future improvement—dynamic import of jsPDF.
- Accessibility: Required asterisks, aria-live, focus management added.
- Resilience: Timeouts + error message surfacing; future: retries, streaming.
- Security (future): Auth, rate limiting, server-side virus scanning, PII redaction toggle.
- Maintainability: PDF logic extracted; modular API wrapper; clear separation of concerns.

## 6. Future Extensions Mapping
| Feature | C4 Impact |
|---------|-----------|
| Auth & Saved Letters | Add Auth component + DB container |
| Tone Selector | Extend Prompt Builder + UI control |
| Keyword Coverage | Analyzer component (backend) + result surface in UI |
| Streaming Output | SSE/WebSocket channel container addition |
| OCR Fallback | Add OCR Service container & orchestration logic |
| Multi-language | i18n layer (frontend) + language param to Prompt Builder |
| Rate Limiting | Middleware component in API container |
| Analytics/Logging | Logging component + Metrics storage |

## 7. Risks & Mitigations
| Risk | Mitigation |
|------|------------|
| Large PDF parsing failures | Fallback OCR, size cap, user guidance |
| LLM hallucinations | Constrain prompt, add sections checking JD alignment |
| API latency | Streaming, caching parsed resume text |
| Data leakage | Avoid storing full resumes by default; explicit user consent |
| Formatting drift | Add tests for justification & wrapping |

## 8. Legend
- Solid arrows: direct synchronous call
- Dashed (future): planned integration
- Brackets (future): not yet implemented

## 9. Summary
The system is a thin reactive frontend container delegating NLP heavy lifting to a Flask API which orchestrates resume parsing and LLM-based generation. Modularization (API & PDF utilities) supports incremental extension toward multi-feature career tooling.
